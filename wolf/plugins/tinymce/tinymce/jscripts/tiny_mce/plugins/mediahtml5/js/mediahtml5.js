tinyMCEPopup.requireLangPack();var oldWidth,oldHeight,ed,url=tinyMCEPopup.getParam("media_external_list_url");function jsEncode(s){s=s.replace(new RegExp('\\\\','g'),'\\\\');s=s.replace(new RegExp('"','g'),'\\"');s=s.replace(new RegExp("'",'g'),"\\'");return s}function setBool(a,p,n){if(typeof a==="undefined"||typeof n!=="string"||typeof a[n]==="undefined"){return}document.forms[0].elements[p+"_"+n].checked=a[n]!=='false'}function getBool(p,n,d,a,b){var v=document.forms[0].elements[p+"_"+n].checked;a=typeof(a)==='undefined'?'true':"'"+jsEncode(a)+"'";b=typeof(b)==='undefined'?'false':"'"+jsEncode(b)+"'";return(v===d)?'':n+(v?':'+a+',':":\'"+b+"\',")}function setStr(a,p,n){var f=document.forms[0],e=f.elements[(p!==null?p+"_":'')+n];if(typeof a==="undefined"||typeof n!=="string"||typeof a[n]==="undefined"){return}if(e.type==="text"){e.value=a[n]}else{selectByValue(f,(p!==null?p+"_":'')+n,a[n])}}function getStr(p,n,d){var e=document.forms[0].elements[(p!==null?p+"_":"")+n];var v=e.type==="text"?e.value:e.options[e.selectedIndex].value;if(n==='src'){v=tinyMCEPopup.editor.convertURL(v,'src',null)}return((n===d||v==='')?'':n+":'"+jsEncode(v)+"',")}function getInt(p,n,d){var e=document.forms[0].elements[(p!==null?p+"_":"")+n];var v=e.type==="text"?e.value:e.options[e.selectedIndex].value;return((n===d||v==='')?'':n+":"+v.replace(/[^0-9]+/g,'')+",")}function getMediaListHTML(){if(typeof(tinyMCEMediaList)!=="undefined"&&tinyMCEMediaList.length>0){var a="";a+='<select id="linklist" name="linklist" style="width: 250px" onchange="this.form.src.value=this.options[this.selectedIndex].value;updatePreview();">';a+='<option value="">---</option>';for(var i=0;i<tinyMCEMediaList.length;i++){a+='<option value="'+tinyMCEMediaList[i][1]+'">'+tinyMCEMediaList[i][0]+'</option>'}a+='</select>';return a}return""}function getType(v){var a,i,c,el,x,f=document.forms[0];a=ed.getParam("media_types","video=mp4,ogv;flash=swf;flv=flv;shockwave=dcr;qt=mov,qt,mpg,mp3,mp4,mpeg;shockwave=dcr;wmp=avi,wmv,wm,asf,asx,wmx,wvx;rmp=rm,ra,ram").split(';');if(v.match(/watch\?v=(.+)(.*)/)){f.width.value='425';f.height.value='350';f.src.value='http://www.youtube.com/v/'+v.match(/v=(.*)(.*)/)[0].split('=')[1];return'flash'}if(v.indexOf('http://video.google.com/videoplay?docid=')===0){f.width.value='425';f.height.value='326';f.src.value='http://video.google.com/googleplayer.swf?docId='+v.substring('http://video.google.com/videoplay?docid='.length)+'&hl=en';return'flash'}for(i=0;i<a.length;i++){c=a[i].split('=');el=c[1].split(',');for(x=0;x<el.length;x++){if(v.indexOf('.'+el[x])!==-1){return c[0]}}}return null}function changedType(t){var d=document;d.getElementById('flash_options').style.display='none';d.getElementById('flv_options').style.display='none';d.getElementById('qt_options').style.display='none';d.getElementById('shockwave_options').style.display='none';d.getElementById('wmp_options').style.display='none';d.getElementById('rmp_options').style.display='none';d.getElementById('video_options').style.display='none';if(t){d.getElementById(t+'_options').style.display='block'}}function serializeParameters(){var d=document,f=d.forms[0],s='',t=f.media_type.options[f.media_type.selectedIndex].value;switch(t){case"video":s+=getStr('video','mimetype');s+=getStr('video','poster');s+=getStr('video','title');s+=getStr('video','media');s+=getBool('video','showcontrols');s+=getBool('video','autoplay');s+=getBool('video','loop');s+=getBool('video','preload');s+=getBool('video','buffer');break;case"flash":s+=getBool('flash','play',true);s+=getBool('flash','loop',true);s+=getBool('flash','menu',true);s+=getBool('flash','swliveconnect',false);s+=getStr('flash','quality');s+=getStr('flash','scale');s+=getStr('flash','salign');s+=getStr('flash','wmode');s+=getStr('flash','base');s+=getStr('flash','flashvars');break;case"qt":s+=getBool('qt','loop',false);s+=getBool('qt','autoplay',true);s+=getBool('qt','cache',false);s+=getBool('qt','controller',true);s+=getBool('qt','correction',false,'none','full');s+=getBool('qt','enablejavascript',false);s+=getBool('qt','kioskmode',false);s+=getBool('qt','autohref',false);s+=getBool('qt','playeveryframe',false);s+=getBool('qt','targetcache',false);s+=getStr('qt','scale');s+=getStr('qt','starttime');s+=getStr('qt','endtime');s+=getStr('qt','target');s+=getStr('qt','qtsrcchokespeed');s+=getStr('qt','volume');s+=getStr('qt','qtsrc');break;case"shockwave":s+=getBool('shockwave','sound');s+=getBool('shockwave','progress');s+=getBool('shockwave','autostart');s+=getBool('shockwave','swliveconnect');s+=getStr('shockwave','swvolume');s+=getStr('shockwave','swstretchstyle');s+=getStr('shockwave','swstretchhalign');s+=getStr('shockwave','swstretchvalign');break;case"wmp":s+=getBool('wmp','autostart',true);s+=getBool('wmp','enabled',false);s+=getBool('wmp','enablecontextmenu',true);s+=getBool('wmp','fullscreen',false);s+=getBool('wmp','invokeurls',true);s+=getBool('wmp','mute',false);s+=getBool('wmp','stretchtofit',false);s+=getBool('wmp','windowlessvideo',false);s+=getStr('wmp','balance');s+=getStr('wmp','baseurl');s+=getStr('wmp','captioningid');s+=getStr('wmp','currentmarker');s+=getStr('wmp','currentposition');s+=getStr('wmp','defaultframe');s+=getStr('wmp','playcount');s+=getStr('wmp','rate');s+=getStr('wmp','uimode');s+=getStr('wmp','volume');break;case"rmp":s+=getBool('rmp','autostart',false);s+=getBool('rmp','loop',false);s+=getBool('rmp','autogotourl',true);s+=getBool('rmp','center',false);s+=getBool('rmp','imagestatus',true);s+=getBool('rmp','maintainaspect',false);s+=getBool('rmp','nojava',false);s+=getBool('rmp','prefetch',false);s+=getBool('rmp','shuffle',false);s+=getStr('rmp','console');s+=getStr('rmp','controls');s+=getStr('rmp','numloop');s+=getStr('rmp','scriptcallbacks');break}s+=getStr(null,'id');s+=getStr(null,'name');s+=getStr(null,'src');s+=getStr(null,'align');s+=getStr(null,'bgcolor');s+=getInt(null,'vspace');s+=getInt(null,'hspace');s+=getStr(null,'width');s+=getStr(null,'height');s=s.length>0?s.substring(0,s.length-1):s;return s}function generatePreview(c){var f=document.forms[0],p=document.getElementById('prev'),h='',cls,pl,n,type,codebase,wp,hp,nw,nh;p.innerHTML='<!-- x --->';nw=parseInt(f.width.value,10);nh=parseInt(f.height.value,10);if(f.width.value!==""&&f.height.value!==""){if(f.constrain.checked){if(c==='width'&&oldWidth!==0){wp=nw/oldWidth;nh=Math.round(wp*nh);f.height.value=nh}else if(c==='height'&&oldHeight!==0){hp=nh/oldHeight;nw=Math.round(hp*nw);f.width.value=nw}}}if(f.width.value!==""){oldWidth=nw}if(f.height.value!==""){oldHeight=nh}pl=serializeParameters();switch(f.media_type.options[f.media_type.selectedIndex].value){case"video":cls='';codebase='';type=pl.mimetype;break;case"flash":cls='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000';codebase='http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0';type='application/x-shockwave-flash';break;case"shockwave":cls='clsid:166B1BCA-3F9C-11CF-8075-444553540000';codebase='http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0';type='application/x-director';break;case"qt":cls='clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B';codebase='http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0';type='video/quicktime';break;case"wmp":cls=ed.getParam('media_wmp6_compatible')?'clsid:05589FA1-C356-11CE-BF01-00AA0055595A':'clsid:6BF52A52-394A-11D3-B153-00C04F79FAA6';codebase='http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701';type='application/x-mplayer2';break;case"rmp":cls='clsid:CFCDAA03-8BE4-11cf-B84B-0020AFBBCCFA';codebase='http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701';type='audio/x-pn-realaudio-plugin';break}if(pl===''){p.innerHTML='';return}pl=tinyMCEPopup.editor.plugins.mediahtml5._parse(pl);if(!pl.src){p.innerHTML='';return}pl.src=tinyMCEPopup.editor.documentBaseURI.toAbsolute(pl.src);pl.width=!pl.width?100:pl.width;pl.height=!pl.height?100:pl.height;pl.id=!pl.id?'obj':pl.id;pl.name=!pl.name?'eobj':pl.name;pl.align=!pl.align?'':pl.align;if(f.media_type.options[f.media_type.selectedIndex].value!=="video"){if(!tinymce.isIE||document.location.protocol!=='https:'){h+='<object classid="'+cls+'" codebase="'+codebase+'" width="'+pl.width+'" height="'+pl.height+'" id="'+pl.id+'" name="'+pl.name+'" align="'+pl.align+'">';for(n in pl){if(typeof n!=="undefined"){h+='<param name="'+n+'" value="'+pl[n]+'">';if(n==='src'&&pl[n].indexOf('://')!==-1){h+='<param name="url" value="'+pl[n]+'" />'}}}}h+='<embed type="'+type+'" ';for(n in pl){if(typeof n!=="undefined"){h+=n+'="'+pl[n]+'" '}}h+='></embed>';if(!tinymce.isIE||document.location.protocol!=='https:'){h+='</object>'}p.innerHTML="<!-- x --->"+h}else{h+='<video';h+=typeof pl.id!=="undefined"?' id="'+pl.id+'"':'';h+=typeof pl.poster!=="undefined"?' poster="'+pl.poster+'"':'';h+=typeof pl.title!=="undefined"?' title="'+pl.title+'"':'';h+=typeof pl.width!=="undefined"?' width="'+pl.width+'"':'';h+=typeof pl.height!=="undefined"?' height="'+pl.height+'"':'';h+=typeof pl.showcontrols==="boolean"&&pl.showcontrols?' controls="controls"':'';h+=typeof pl.autoplay==="boolean"&&pl.autoplay?' autoplay="autoplay"':'';h+=typeof pl.preload==="boolean"&&pl.preload?' preload="auto"':'';h+=typeof pl.loop==="boolean"&&pl.loop?' loop="true"':'';h+=typeof pl.autobuffer==="boolean"&&pl.autobuffer?' autobuffer="autobuffer"':'';h+='>';h+='<source src="'+pl.src;h+=typeof pl.mimetype!=="undefined"?'" type="'+pl.mimetype+'"':'';h+=typeof pl.media!=="undefined"?'" media="'+pl.media+'"':'';h+=' />';h+='</video>';p.innerHTML="<!-- x --->"+h}}function updatePreview(){var f=document.forms[0],type;f.width.value=f.width.value||'320';f.height.value=f.height.value||'240';type=getType(f.src.value);selectByValue(f,'media_type',type);changedType(type);generatePreview()}function switchType(v){var t=getType(v),d=document,f=d.forms[0];if(!t){return}selectByValue(d.forms[0],'media_type',t);changedType(t);if(t==='qt'&&f.src.value.toLowerCase().indexOf('rtsp://')!==-1){alert(ed.getLang("media_qt_stream_warn"));if(f.qt_qtsrc.value===''){f.qt_qtsrc.value=f.src.value}}}function init(){var a="",f,val;var b="video",fe;ed=tinyMCEPopup.editor;tinyMCEPopup.resizeToInnerSize();f=document.forms[0];fe=ed.selection.getNode();if((/mceItem(Video|Flash|ShockWave|WindowsMedia|QuickTime|RealMedia)/).test(ed.dom.getAttrib(fe,'class'))){a=fe.title;switch(ed.dom.getAttrib(fe,'class')){case'mceItemVideo':b='video';break;case'mceItemFlash':b='flash';break;case'mceItemFlashVideo':b='flv';break;case'mceItemShockWave':b='shockwave';break;case'mceItemWindowsMedia':b='wmp';break;case'mceItemQuickTime':b='qt';break;case'mceItemRealMedia':b='rmp';break}document.forms[0].insert.value=ed.getLang('update','Insert',true)}document.getElementById('filebrowsercontainer').innerHTML=getBrowserHTML('filebrowser','src','media','mediahtml5');document.getElementById('qtsrcfilebrowsercontainer').innerHTML=getBrowserHTML('qtsrcfilebrowser','qt_qtsrc','media','mediahtml5');document.getElementById('bgcolor_pickcontainer').innerHTML=getColorPickerHTML('bgcolor_pick','bgcolor');var c=getMediaListHTML('medialist','src','media','mediahtml5');if(c===""){document.getElementById("linklistrow").style.display='none'}else{document.getElementById("linklistcontainer").innerHTML=c}if(isVisible('filebrowser')){document.getElementById('src').style.width='230px'}if(a!==""){a=tinyMCEPopup.editor.plugins.mediahtml5._parse(a);switch(b){case"video":setStr(a,'video','mimetype');setStr(a,'video','poster');setStr(a,'video','title');setStr(a,'video','media');setBool(a,'video','showcontrols');setBool(a,'video','autoplay');setBool(a,'video','loop');setBool(a,'video','preload');setBool(a,'video','buffer');break;case"flash":setBool(a,'flash','play');setBool(a,'flash','loop');setBool(a,'flash','menu');setBool(a,'flash','swliveconnect');setStr(a,'flash','quality');setStr(a,'flash','scale');setStr(a,'flash','salign');setStr(a,'flash','wmode');setStr(a,'flash','base');setStr(a,'flash','flashvars');break;case"qt":setBool(a,'qt','loop');setBool(a,'qt','autoplay');setBool(a,'qt','cache');setBool(a,'qt','controller');setBool(a,'qt','correction');setBool(a,'qt','enablejavascript');setBool(a,'qt','kioskmode');setBool(a,'qt','autohref');setBool(a,'qt','playeveryframe');setBool(a,'qt','tarsetcache');setStr(a,'qt','scale');setStr(a,'qt','starttime');setStr(a,'qt','endtime');setStr(a,'qt','tarset');setStr(a,'qt','qtsrcchokespeed');setStr(a,'qt','volume');setStr(a,'qt','qtsrc');break;case"shockwave":setBool(a,'shockwave','sound');setBool(a,'shockwave','progress');setBool(a,'shockwave','autostart');setBool(a,'shockwave','swliveconnect');setStr(a,'shockwave','swvolume');setStr(a,'shockwave','swstretchstyle');setStr(a,'shockwave','swstretchhalign');setStr(a,'shockwave','swstretchvalign');break;case"wmp":setBool(a,'wmp','autostart');setBool(a,'wmp','enabled');setBool(a,'wmp','enablecontextmenu');setBool(a,'wmp','fullscreen');setBool(a,'wmp','invokeurls');setBool(a,'wmp','mute');setBool(a,'wmp','stretchtofit');setBool(a,'wmp','windowlessvideo');setStr(a,'wmp','balance');setStr(a,'wmp','baseurl');setStr(a,'wmp','captioningid');setStr(a,'wmp','currentmarker');setStr(a,'wmp','currentposition');setStr(a,'wmp','defaultframe');setStr(a,'wmp','playcount');setStr(a,'wmp','rate');setStr(a,'wmp','uimode');setStr(a,'wmp','volume');break;case"rmp":setBool(a,'rmp','autostart');setBool(a,'rmp','loop');setBool(a,'rmp','autogotourl');setBool(a,'rmp','center');setBool(a,'rmp','imagestatus');setBool(a,'rmp','maintainaspect');setBool(a,'rmp','nojava');setBool(a,'rmp','prefetch');setBool(a,'rmp','shuffle');setStr(a,'rmp','console');setStr(a,'rmp','controls');setStr(a,'rmp','numloop');setStr(a,'rmp','scriptcallbacks');break}setStr(a,null,'src');setStr(a,null,'id');setStr(a,null,'name');setStr(a,null,'vspace');setStr(a,null,'hspace');setStr(a,null,'bgcolor');setStr(a,null,'align');setStr(a,null,'width');setStr(a,null,'height');if(a&&(val=ed.dom.getAttrib(fe,"width"))!==""){a.width=f.width.value=val}if((val=ed.dom.getAttrib(fe,"height"))!==""){a.height=f.height.value=val}oldWidth=a.width?parseInt(a.width,10):0;oldHeight=a.height?parseInt(a.height,10):0}else{oldWidth=oldHeight=0}selectByValue(f,'media_type',b);changedType(b);updateColor('bgcolor_pick','bgcolor');TinyMCE_EditableSelects.init();generatePreview()}function insertMedia(){var a,f=document.forms[0],h;tinyMCEPopup.restoreSelection();if(!AutoValidator.validate(f)){tinyMCEPopup.alert(ed.getLang('invalid_data'));return false}f.width.value=f.width.value===""?100:f.width.value;f.height.value=f.height.value===""?100:f.height.value;a=ed.selection.getNode();if(a!==null&&(/mceItem(Video|Flash|ShockWave|WindowsMedia|QuickTime|RealMedia)/).test(ed.dom.getAttrib(a,'class'))){switch(f.media_type.options[f.media_type.selectedIndex].value){case"video":a.className="mceItemVideo";break;case"flash":a.className="mceItemFlash";break;case"flv":a.className="mceItemFlashVideo";break;case"shockwave":a.className="mceItemShockWave";break;case"qt":a.className="mceItemQuickTime";break;case"wmp":a.className="mceItemWindowsMedia";break;case"rmp":a.className="mceItemRealMedia";break}if(a.width!==f.width.value||a.height!==f.height.value){ed.execCommand('mceRepaint')}a.title=serializeParameters();a.width=f.width.value;a.height=f.height.value;a.style.width=f.width.value+(f.width.value.indexOf('%')===-1?'px':'');a.style.height=f.height.value+(f.height.value.indexOf('%')===-1?'px':'');a.align=f.align.options[f.align.selectedIndex].value}else{h='<img src="'+tinyMCEPopup.getWindowArg("plugin_url")+'/img/trans.gif"';switch(f.media_type.options[f.media_type.selectedIndex].value){case"video":h+=' class="mceItemVideo"';break;case"flash":h+=' class="mceItemFlash"';break;case"flv":h+=' class="mceItemFlashVideo"';break;case"shockwave":h+=' class="mceItemShockWave"';break;case"qt":h+=' class="mceItemQuickTime"';break;case"wmp":h+=' class="mceItemWindowsMedia"';break;case"rmp":h+=' class="mceItemRealMedia"';break}h+=' title="'+serializeParameters()+'"';h+=' width="'+f.width.value+'"';h+=' height="'+f.height.value+'"';h+=' align="'+f.align.options[f.align.selectedIndex].value+'"';h+=' />';ed.execCommand('mceInsertContent',false,h)}tinyMCEPopup.close()}if(url){document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(url)+'"></script>')}tinyMCEPopup.onInit.add(init);